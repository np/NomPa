{-# OPTIONS --universe-polymorphism #-}
module NaPa.LogicalRelation where

import Level as L
open import Irrelevance
open import Data.Nat.NP hiding (_âŠ”_) renaming (_+_ to _+â„•_; _â‰¤_ to _â‰¤â„•_; _â‰¤?_ to _â‰¤?â„•_; _<_ to _<â„•_
                                              ;module == to ==â„•; _==_ to _==â„•_)
open import Data.Nat.Logical renaming (_â‰Ÿ_ to _â‰Ÿâ„•_; _âŸ¦+âŸ§_ to _âŸ¦+â„•âŸ§_)
open import Data.Nat.Properties as Nat
open import Data.Empty
open import Data.Unit
open import Data.Maybe.NP
open import Data.Bool.NP
open import Data.Two renaming (âœ“-Â¬-not to T'Â¬'not)
open import Data.Two.Logical
open import Data.Sum.NP
open import Data.Product.NP
import Relation.Binary.PropositionalEquality as â‰¡
open â‰¡ using (_â‰¡_)
open import Relation.Nullary
open import Relation.Nullary.Decidable
open import Relation.Binary.NP
open import Relation.Binary.Logical
open import Relation.Unary.NP using (Pred)
open import Function
open import Function.Equality as âŸ¶â‰¡ using (_âŸ¶_; _âŸ¨$âŸ©_)
open import Function.Injection.NP using (Injection; Injective; module
    Injection; _âˆˆ_)
open import NaPa hiding (_âˆˆ_)

private
  module Inj = Injection
  module â„•s = Setoid âŸ¦â„•âŸ§-setoid
  module ==â„•s = Setoid ==â„•.setoid
  module â„•e = Equality âŸ¦â„•âŸ§-equality

_âŸ¨$âŸ©áµ¢_ : âˆ€ {fâ‚ fâ‚‚ tâ‚ tâ‚‚}
           {From : Setoid fâ‚ fâ‚‚} {To : Setoid tâ‚ tâ‚‚}
         â†’ Injection From To â†’ Setoid.Carrier From â†’ Setoid.Carrier To
_âŸ¨$âŸ©áµ¢_ = âŸ¶â‰¡._âŸ¨$âŸ©_ âˆ˜ Inj.to -- inj x = Inj.to inj âŸ¨$âŸ© x

==â„•-dec : âˆ€ x y â†’ âŸ¦ðŸšâŸ§ âŒŠ x â‰Ÿâ„• y âŒ‹ (x ==â„• y)
==â„•-dec x y with x â‰Ÿâ„• y
... | yes p = âŸ¦1â‚‚âŸ§â€² (==â„•s.reflexive (â„•e.to-propositional p))
... | no Â¬p = âŸ¦0â‚‚âŸ§â€² (T'Â¬'not (Â¬p âˆ˜ â„•s.reflexive âˆ˜ ==â„•.sound _ _))

âŸ¦decâŸ§ : âˆ€ {P Q : Set} (decP : Dec P) (decQ : Dec Q) â†’ (P â†’ Q) â†’ (Q â†’ P) â†’ âŸ¦ðŸšâŸ§ âŒŠ decP âŒ‹ âŒŠ decQ âŒ‹
âŸ¦decâŸ§ (yes _) (yes _) _ _ = âŸ¦1â‚‚âŸ§
âŸ¦decâŸ§ (no  _) (no  _) _ _ = âŸ¦0â‚‚âŸ§
âŸ¦decâŸ§ (yes p) (no Â¬q) f _ = âŠ¥-elim (Â¬q (f p))
âŸ¦decâŸ§ (no Â¬p) (yes q) _ g = âŠ¥-elim (Â¬p (g q))

âŸ¦WorldâŸ§ : (Î±â‚ Î±â‚‚ : World) â†’ Set
âŸ¦WorldâŸ§ = Injection on Nm

-- dup with NotSoFresh.LogicalRelation
âŸ¦WorldPredâŸ§ : (Pâ‚ Pâ‚‚ : Pred L.zero World) â†’ Setâ‚
âŸ¦WorldPredâŸ§ = âŸ¦PredâŸ§ _ âŸ¦WorldâŸ§

âŸ¦WorldRelâŸ§ : (Râ‚ Râ‚‚ : Rel World L.zero) â†’ Setâ‚
âŸ¦WorldRelâŸ§ = âŸ¦RelâŸ§ âŸ¦WorldâŸ§ L.zero

_âŸ¦â†‘1âŸ§ : (âŸ¦WorldâŸ§ âŸ¦â†’âŸ§ âŸ¦WorldâŸ§) _â†‘1 _â†‘1
_âŸ¦â†‘1âŸ§ {Î±â‚} {Î±â‚‚} Î±áµ£ = record { to = to; injective = to-inj } where
  to : Nm (Î±â‚ â†‘1) âŸ¶ Nm (Î±â‚‚ â†‘1)
  to = Nameâ†’-to-NmâŸ¶ (protectâ†‘1 (_âŸ¨$âŸ©áµ¢_ Î±áµ£))
  to-inj : Injective to
  to-inj {zero  , _} {zero  , _} âŸ¦zeroâŸ§    = âŸ¦zeroâŸ§
  to-inj {suc _ , _} {suc _ , _} (âŸ¦sucâŸ§ e) = âŸ¦sucâŸ§ (Inj.injective Î±áµ£ e)
  to-inj {suc _ , _} {zero  , _} ()
  to-inj {zero  , _} {suc _ , _} ()

infix 21 _âŸ¦+1âŸ§
_âŸ¦+1âŸ§ : (âŸ¦WorldâŸ§ âŸ¦â†’âŸ§ âŸ¦WorldâŸ§) _+1 _+1
_âŸ¦+1âŸ§ {Î±â‚} {Î±â‚‚} Î±áµ£ = record { to = to; injective = inj } where
  to : Nm (Î±â‚ +1) âŸ¶ Nm (Î±â‚‚ +1)
  to = Nameâ†’-to-NmâŸ¶ (Î» x â†’ sucá´º (Î±áµ£ âŸ¨$âŸ©áµ¢ (predá´º x)))
  inj : Injective to
  inj {zero  , _} {zero  , _} _         = âŸ¦zeroâŸ§
  inj {suc _ , _} {suc _ , _} (âŸ¦sucâŸ§ e) = âŸ¦sucâŸ§ (Inj.injective Î±áµ£ e)
  inj {suc _ , _} {zero  , ()} _
  inj {zero  , ()} {suc _ , _} _

_âŸ¦â†‘_âŸ§ : (âŸ¦WorldâŸ§ âŸ¦â†’âŸ§ âŸ¦â„•âŸ§ âŸ¦â†’âŸ§ âŸ¦WorldâŸ§) _â†‘_ _â†‘_
_âŸ¦â†‘_âŸ§ Î±áµ£ âŸ¦zeroâŸ§    = Î±áµ£
_âŸ¦â†‘_âŸ§ Î±áµ£ (âŸ¦sucâŸ§ k) = Î±áµ£ âŸ¦â†‘ k âŸ§ âŸ¦â†‘1âŸ§

_âŸ¦+áµ‚âŸ§_ : (âŸ¦WorldâŸ§ âŸ¦â†’âŸ§ âŸ¦â„•âŸ§ âŸ¦â†’âŸ§ âŸ¦WorldâŸ§) _+áµ‚_ _+áµ‚_
_âŸ¦+áµ‚âŸ§_ Î±áµ£ âŸ¦zeroâŸ§    = Î±áµ£
_âŸ¦+áµ‚âŸ§_ Î±áµ£ (âŸ¦sucâŸ§ k) = (Î±áµ£ âŸ¦+áµ‚âŸ§ k) âŸ¦+1âŸ§

âŸ¦NameâŸ§ : âŸ¦PredâŸ§ L.zero âŸ¦WorldâŸ§ Name Name
âŸ¦NameâŸ§ Î±áµ£ xâ‚ xâ‚‚ = ( xâ‚ , xâ‚‚ ) âˆˆ Î±áµ£

âŸ¦NameâŸ§â‰¡ : âŸ¦WorldPredâŸ§ Name Name
âŸ¦NameâŸ§â‰¡ Î±áµ£ xâ‚ xâ‚‚ = Î±áµ£ âŸ¨$âŸ©áµ¢ xâ‚ â‰¡ xâ‚‚

âŸ¦Ã¸âŸ§ : âŸ¦WorldâŸ§ Ã¸ Ã¸
âŸ¦Ã¸âŸ§ = record { to = Nameâ†’-to-NmâŸ¶ NameÃ¸-elim
             ; injective = Î»{x} â†’ NameÃ¸-elim x }

_âŸ¦==á´ºâŸ§_ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦ðŸšâŸ§) _==á´º_ _==á´º_
_âŸ¦==á´ºâŸ§_ Î±áµ£ {_} {xâ‚‚} xáµ£ {_} {yâ‚‚} yáµ£ = helper (â‰¡á´ºâ‡’â‰¡ {_} {_} {xâ‚‚} xáµ£) (â‰¡á´ºâ‡’â‰¡ {_} {_} {yâ‚‚} yáµ£) where
  helper : (âŸ¦NameâŸ§â‰¡ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦NameâŸ§â‰¡ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦ðŸšâŸ§) _==á´º_ _==á´º_
  helper {x} â‰¡.refl {y} â‰¡.refl =
       x ==á´º y       â‰ˆâŸ¨ sym (==â„•-dec _ _) âŸ©
       âŒŠ x â‰Ÿá´º y âŒ‹   â‰ˆâŸ¨ âŸ¦decâŸ§ (x â‰Ÿá´º y) (xâ€² â‰Ÿá´º yâ€²) (âŸ¶â‰¡.cong (Inj.to Î±áµ£)) (Inj.injective Î±áµ£) âŸ©
       âŒŠ xâ€² â‰Ÿá´º yâ€² âŒ‹ â‰ˆâŸ¨ ==â„•-dec _ _ âŸ©
       xâ€² ==á´º yâ€² âˆŽ
    where
      xâ€² = Î±áµ£ âŸ¨$âŸ©áµ¢ x
      yâ€² = Î±áµ£ âŸ¨$âŸ©áµ¢ y
      open âŸ¦ðŸšâŸ§-Props using (sym)
      open âŸ¦ðŸšâŸ§-Reasoning

âŸ¦zeroá´ºâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦â†‘1âŸ§)) zeroá´º zeroá´º
âŸ¦zeroá´ºâŸ§ _ = âŸ¦zeroâŸ§

âŸ¦sucá´ºâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+1âŸ§)) sucá´º sucá´º
âŸ¦sucá´ºâŸ§ _ = âŸ¦sucâŸ§

âŸ¦sucá´ºâ†‘âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦â†‘1âŸ§)) sucá´ºâ†‘ sucá´ºâ†‘
âŸ¦sucá´ºâ†‘âŸ§ _ = âŸ¦sucâŸ§

âŸ¦predá´ºâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î±áµ£) predá´º predá´º
âŸ¦predá´ºâŸ§ _ = âŸ¦â„•âŸ§-cong (Î» x â†’ x âˆ¸ 1)

âŸ¦addá´ºâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§ (âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£))) addá´º addá´º
âŸ¦addá´ºâŸ§ _ âŸ¦zeroâŸ§ x = x
âŸ¦addá´ºâŸ§ {Î±â‚} {Î±â‚‚} Î±áµ£ (âŸ¦sucâŸ§ {kâ‚} {kâ‚‚} káµ£) {xâ‚} {xâ‚‚} x
   = â„•.suc (name ((Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£) âŸ¨$âŸ©áµ¢ (kâ‚ +â„• name xâ‚ , _{-p-})))
   â‰ˆâŸ¨ â‰¡á´º-âŸ¦â„•âŸ§-cong (Î» x â†’ suc (name ((Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£) âŸ¨$âŸ©áµ¢ x))) â„•e.refl âŸ©
     suc (name ((Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£) âŸ¨$âŸ©áµ¢ (kâ‚ +â„• name xâ‚ , _{-q-})))
   â‰ˆâŸ¨ âŸ¦sucâŸ§ (âŸ¦addá´ºâŸ§ Î±áµ£ káµ£ {xâ‚} {xâ‚‚} x) âŸ©
     suc (kâ‚‚ +â„• name xâ‚‚)
   âˆŽ where open âŸ¦â„•âŸ§-Reasoning

âŸ¦subtractá´ºâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î±áµ£) subtractá´º subtractá´º
âŸ¦subtractá´ºâŸ§ _ âŸ¦zeroâŸ§ x = x
âŸ¦subtractá´ºâŸ§ {Î±â‚} {Î±â‚‚} Î±áµ£ (âŸ¦sucâŸ§ {kâ‚} {kâ‚‚} káµ£) {xâ‚} {xâ‚‚} xáµ£
   = name (Î±áµ£ âŸ¨$âŸ©áµ¢ (name xâ‚ âˆ¸ suc kâ‚ , _{-p-}))
   â‰ˆâŸ¨ â‰¡-âŸ¦â„•âŸ§-cong (Î» x â†’ name (Î±áµ£ âŸ¨$âŸ©áµ¢ x)) (name-injective (â‰¡.sym (âˆ¸-+-assoc (name xâ‚) 1 kâ‚))) âŸ©
      name (Î±áµ£ âŸ¨$âŸ©áµ¢ (name xâ‚ âˆ¸ 1 âˆ¸ kâ‚ , _{-r-}))
   â‰ˆâŸ¨ âŸ¦subtractá´ºâŸ§ Î±áµ£ káµ£ {predá´º xâ‚} {predá´º xâ‚‚} (âŸ¦predá´ºâŸ§ (Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£) {xâ‚} {xâ‚‚} xáµ£)  âŸ©
      (name xâ‚‚ âˆ¸ 1) âˆ¸ kâ‚‚
   â‰ˆâŸ¨ â„•e.reflexive (âˆ¸-+-assoc (name xâ‚‚) 1 kâ‚‚) âŸ©
      name xâ‚‚ âˆ¸ suc kâ‚‚
   âˆŽ where open âŸ¦â„•âŸ§-Reasoning

âŸ¦cmpá´º-boolâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦â†‘ káµ£ âŸ§) âŸ¦â†’âŸ§ âŸ¦ðŸšâŸ§) cmpá´º-bool cmpá´º-bool
âŸ¦cmpá´º-boolâŸ§ Î±áµ£ káµ£ {xâ‚} {xâ‚‚} xáµ£ = helper káµ£ {xâ‚} {xâ‚‚} (â‰¡á´ºâ‡’â‰¡ xáµ£) where
  helper : (âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§â‰¡ (Î±áµ£ âŸ¦â†‘ káµ£ âŸ§) âŸ¦â†’âŸ§ âŸ¦ðŸšâŸ§) cmpá´º-bool cmpá´º-bool
  helper âŸ¦zeroâŸ§                   â‰¡.refl  = âŸ¦0â‚‚âŸ§
  helper (âŸ¦sucâŸ§ káµ£) {zero  , _ }  â‰¡.refl  = âŸ¦1â‚‚âŸ§
  helper (âŸ¦sucâŸ§ káµ£) {suc x , pfâ‚} â‰¡.refl  = helper káµ£ {x , pfâ‚} â‰¡.refl

âŸ¦easy-cmpá´ºâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§
                  âŸ¦NameâŸ§ (Î±áµ£ âŸ¦â†‘ káµ£ âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (âŸ¦Ã¸âŸ§ âŸ¦â†‘ káµ£ âŸ§) âŸ¦âŠŽâŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£)
             ) easy-cmpá´º easy-cmpá´º
âŸ¦easy-cmpá´ºâŸ§ Î±áµ£ káµ£ {xâ‚} {xâ‚‚} xáµ£ = helper káµ£ {xâ‚} {xâ‚‚} (â‰¡á´ºâ‡’â‰¡ xáµ£) where
  helper : (âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§â‰¡ (Î±áµ£ âŸ¦â†‘ káµ£ âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (âŸ¦Ã¸âŸ§ âŸ¦â†‘ káµ£ âŸ§) âŸ¦âŠŽâŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£)) easy-cmpá´º easy-cmpá´º
  helper âŸ¦zeroâŸ§                             â‰¡.refl = âŸ¦inrâŸ§ (â‰¡á´º-âŸ¦â„•âŸ§-cong (Î» x â†’ name (Î±áµ£ âŸ¨$âŸ©áµ¢ x)) â„•e.refl)
  helper (âŸ¦sucâŸ§ káµ£)           {zero  , _ }  â‰¡.refl = âŸ¦inlâŸ§ âŸ¦zeroâŸ§
  helper (âŸ¦sucâŸ§ {kâ‚} {kâ‚‚} káµ£) {suc x , pfâ‚} â‰¡.refl
    = âŸ¦mapâŸ§ _ _ _ _ âŸ¦sucâŸ§ âŸ¦sucâŸ§ (helper káµ£ {x , pfâ‚} â‰¡.refl)

âŸ¦cmpá´ºâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§
                  âŸ¦NameâŸ§ (Î±áµ£ âŸ¦â†‘ káµ£ âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (âŸ¦Ã¸âŸ§ âŸ¦â†‘ káµ£ âŸ§) âŸ¦âŠŽâŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£)
         ) cmpá´º cmpá´º
âŸ¦cmpá´ºâŸ§ {Î±â‚} {Î±â‚‚} Î±áµ£ {kâ‚} {kâ‚‚} káµ£ {xâ‚} {xâ‚‚} xáµ£ =
   â‰¡.subst (Î» x â†’ (âŸ¦NameâŸ§ (âŸ¦Ã¸âŸ§ âŸ¦â†‘ káµ£ âŸ§) âŸ¦âŠŽâŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£)) (cmpá´º {Î±â‚} kâ‚ xâ‚) x)
           (easy-cmpá´ºâ‰—cmpá´º {Î±â‚‚} kâ‚‚ xâ‚‚)
           (â‰¡.subst (Î» x â†’ (âŸ¦NameâŸ§ (âŸ¦Ã¸âŸ§ âŸ¦â†‘ káµ£ âŸ§) âŸ¦âŠŽâŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£)) x
                    (easy-cmpá´º {Î±â‚‚} kâ‚‚ xâ‚‚))
                    (easy-cmpá´ºâ‰—cmpá´º {Î±â‚} kâ‚ xâ‚) (âŸ¦easy-cmpá´ºâŸ§ Î±áµ£ káµ£ {xâ‚} {xâ‚‚} xáµ£))

âŸ¦protectâ†‘1âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§
           (âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î²áµ£) âŸ¦â†’âŸ§ (âŸ¦NameâŸ§ (Î±áµ£ âŸ¦â†‘1âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î²áµ£ âŸ¦â†‘1âŸ§))) protectâ†‘1 protectâ†‘1
âŸ¦protectâ†‘1âŸ§ {Î±â‚} {Î±â‚‚} Î±áµ£ {Î²â‚} {Î²â‚‚} Î²áµ£ {fâ‚} {fâ‚‚} fáµ£ {xâ‚} {xâ‚‚} xáµ£ = helper {xâ‚} {xâ‚‚} (â‰¡á´ºâ‡’â‰¡ xáµ£) where
   helper : (âŸ¦NameâŸ§â‰¡ (Î±áµ£ âŸ¦â†‘1âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î²áµ£ âŸ¦â†‘1âŸ§)) (protectâ†‘1 fâ‚) (protectâ†‘1 fâ‚‚)
   helper {zero ,  _}  â‰¡.refl = âŸ¦zeroâŸ§
   helper {suc x , pf} â‰¡.refl = âŸ¦sucâŸ§ (fáµ£ â„•e.refl)

_âŸ¦âŠ†âŸ§b_ : âŸ¦WorldRelâŸ§ _âŠ†_ _âŠ†_
_âŸ¦âŠ†âŸ§b_ Î±áµ£ Î²áµ£ Î±âŠ†Î²â‚ Î±âŠ†Î²â‚‚
  = (âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î²áµ£) (coerceá´º Î±âŠ†Î²â‚) (coerceá´º Î±âŠ†Î²â‚‚)

data _âŸ¦âŠ†âŸ§_ {Î±â‚ Î±â‚‚} (Î±áµ£ : âŸ¦WorldâŸ§ Î±â‚ Î±â‚‚) {Î²â‚ Î²â‚‚} (Î²áµ£ : âŸ¦WorldâŸ§ Î²â‚ Î²â‚‚) (x : Î±â‚ âŠ† Î²â‚) (y : Î±â‚‚ âŠ† Î²â‚‚) : Set where
  mkâŸ¦âŠ†âŸ§ : _âŸ¦âŠ†âŸ§b_ Î±áµ£ Î²áµ£ x y â†’ _âŸ¦âŠ†âŸ§_ Î±áµ£ Î²áµ£ x y

unâŸ¦âŠ†âŸ§ : âˆ€ {Î±â‚ Î±â‚‚} {Î±áµ£ : âŸ¦WorldâŸ§ Î±â‚ Î±â‚‚} {Î²â‚ Î²â‚‚} {Î²áµ£ : âŸ¦WorldâŸ§ Î²â‚ Î²â‚‚} {x : Î±â‚ âŠ† Î²â‚} {y : Î±â‚‚ âŠ† Î²â‚‚} â†’
  _âŸ¦âŠ†âŸ§_ Î±áµ£ Î²áµ£ x y â†’ _âŸ¦âŠ†âŸ§b_ Î±áµ£ Î²áµ£ x y
unâŸ¦âŠ†âŸ§ (mkâŸ¦âŠ†âŸ§ x) {a} {b} c = x {a} {b} c

-- this is the start of an experimentation to see if the issue with âŸ¦dropNameâŸ§ is due
-- to implicit lambdas.
_âŸ¦âŠ†âŸ§e_ : âŸ¦WorldRelâŸ§ _âŠ†_ _âŠ†_
_âŸ¦âŠ†âŸ§e_ Î±áµ£ Î²áµ£ Î±âŠ†Î²â‚ Î±âŠ†Î²â‚‚
  = (âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§e âŸ¦NameâŸ§ Î²áµ£) (coerceá´º Î±âŠ†Î²â‚) (coerceá´º Î±âŠ†Î²â‚‚)

âŸ¦âŠ†-reflâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î±áµ£) âŠ†-refl âŠ†-refl
âŸ¦âŠ†-reflâŸ§ _ = mkâŸ¦âŠ†âŸ§ (Î» xáµ£ â†’ xáµ£)

âŸ¦âŠ†-transâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î³áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§
                  Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£ âŸ¦â†’âŸ§ (Î²áµ£ âŸ¦âŠ†âŸ§ Î³áµ£ âŸ¦â†’âŸ§ (Î±áµ£ âŸ¦âŠ†âŸ§ Î³áµ£))) âŠ†-trans âŠ†-trans
âŸ¦âŠ†-transâŸ§ _ _ _ {_} {fâ‚‚} f g = mkâŸ¦âŠ†âŸ§ (Î» {xâ‚} {xâ‚‚} xáµ£ â†’ unâŸ¦âŠ†âŸ§ g {_} {coerceá´º fâ‚‚ xâ‚‚} (unâŸ¦âŠ†âŸ§ f {xâ‚} {xâ‚‚} xáµ£))

âŸ¦coerceá´ºâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£ âŸ¦â†’âŸ§ (âŸ¦NameâŸ§ Î±áµ£ âŸ¦â†’âŸ§ âŸ¦NameâŸ§ Î²áµ£)) coerceá´º coerceá´º
âŸ¦coerceá´ºâŸ§ _ _ Î±âŠ†Î²áµ£ {xâ‚} {xâ‚‚} xáµ£ = unâŸ¦âŠ†âŸ§ Î±âŠ†Î²áµ£ {xâ‚} {xâ‚‚} xáµ£

âŸ¦Â¬NameÃ¸âŸ§ : (âŸ¦Â¬âŸ§(âŸ¦NameâŸ§ âŸ¦Ã¸âŸ§)) Â¬NameÃ¸ Â¬NameÃ¸
âŸ¦Â¬NameÃ¸âŸ§ {_ , ()}

âŸ¦âŠ†-cong-â†‘1âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£ âŸ¦â†’âŸ§ (Î±áµ£ âŸ¦â†‘1âŸ§) âŸ¦âŠ†âŸ§ (Î²áµ£ âŸ¦â†‘1âŸ§)) âŠ†-cong-â†‘1 âŠ†-cong-â†‘1
âŸ¦âŠ†-cong-â†‘1âŸ§ Î±áµ£ Î²áµ£ {Î±âŠ†Î²â‚} {Î±âŠ†Î²â‚‚} Î±âŠ†Î²áµ£ = mkâŸ¦âŠ†âŸ§ (Î» {xâ‚} {xâ‚‚} xáµ£ â†’ helper {xâ‚} {xâ‚‚} (â‰¡á´ºâ‡’â‰¡ xáµ£)) where
  helper : (âŸ¦NameâŸ§â‰¡ (Î±áµ£ âŸ¦â†‘1âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î²áµ£ âŸ¦â†‘1âŸ§)) (coerceá´º (âŠ†-cong-â†‘1 Î±âŠ†Î²â‚)) (coerceá´º (âŠ†-cong-â†‘1 Î±âŠ†Î²â‚‚))
  helper {zero  , _} â‰¡.refl = âŸ¦zeroâŸ§
  helper {suc x , p} â‰¡.refl = âŸ¦sucâŸ§ (unâŸ¦âŠ†âŸ§ Î±âŠ†Î²áµ£ {x , p} {Î±áµ£ âŸ¨$âŸ©áµ¢ (x , p)} â„•e.refl)

âŸ¦âŠ†-cong-+1âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£ âŸ¦â†’âŸ§ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦âŠ†âŸ§ (Î²áµ£ âŸ¦+1âŸ§)) âŠ†-cong-+1 âŠ†-cong-+1
âŸ¦âŠ†-cong-+1âŸ§ Î±áµ£ Î²áµ£ {Î±âŠ†Î²â‚} {Î±âŠ†Î²â‚‚} Î±âŠ†Î²áµ£ = mkâŸ¦âŠ†âŸ§ (Î» {xâ‚} {xâ‚‚} xáµ£ â†’ helper {xâ‚} {xâ‚‚} (â‰¡á´ºâ‡’â‰¡ xáµ£)) where
  helper : (âŸ¦NameâŸ§â‰¡ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î²áµ£ âŸ¦+1âŸ§)) (coerceá´º (âŠ†-cong-+1 Î±âŠ†Î²â‚)) (coerceá´º (âŠ†-cong-+1 Î±âŠ†Î²â‚‚))
  helper {zero  , ()} _
  helper {suc x , p} â‰¡.refl = âŸ¦sucâŸ§ (unâŸ¦âŠ†âŸ§ Î±âŠ†Î²áµ£ {x , p} {Î±áµ£ âŸ¨$âŸ©áµ¢ (x , p)} â„•e.refl)

âŸ¦âŠ†-+1â†‘1âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦âŠ†âŸ§ (Î±áµ£ âŸ¦â†‘1âŸ§)) âŠ†-+1â†‘1 âŠ†-+1â†‘1
âŸ¦âŠ†-+1â†‘1âŸ§ Î±áµ£ = mkâŸ¦âŠ†âŸ§ (Î» {xâ‚} {xâ‚‚} xáµ£ â†’ helper {xâ‚} {xâ‚‚} (â‰¡á´ºâ‡’â‰¡ xáµ£)) where
  helper : (âŸ¦NameâŸ§â‰¡ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦â†‘1âŸ§)) (coerceá´º âŠ†-+1â†‘1) (coerceá´º âŠ†-+1â†‘1)
  helper {zero  , ()} _
  helper {suc x , p} â‰¡.refl = âŸ¦sucâŸ§ â„•e.refl

âŸ¦âŠ†-Ã¸âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦Ã¸âŸ§ âŸ¦âŠ†âŸ§ Î±áµ£) âŠ†-Ã¸ âŠ†-Ã¸
âŸ¦âŠ†-Ã¸âŸ§ Î±áµ£ = mkâŸ¦âŠ†âŸ§ (Î» {Î·â‚} {Î·â‚‚} Î· â†’ helper {Î·â‚} {Î·â‚‚} Î·) where
   helper : (âŸ¦Ã¸âŸ§ âŸ¦âŠ†âŸ§b Î±áµ£) âŠ†-Ã¸ âŠ†-Ã¸
   helper {_ , ()}

âŸ¦âŠ†-+1-injâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦âŠ†âŸ§ (Î²áµ£ âŸ¦+1âŸ§) âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£) âŠ†-+1-inj âŠ†-+1-inj
âŸ¦âŠ†-+1-injâŸ§ _ _ Î±+âŠ†Î²+áµ£ = mkâŸ¦âŠ†âŸ§ (Î» {xâ‚} {xâ‚‚} xáµ£ â†’ âŸ¦â„•âŸ§-cong (Î» x â†’ x âˆ¸ 1) (unâŸ¦âŠ†âŸ§ Î±+âŠ†Î²+áµ£ {sucá´º xâ‚} {sucá´º xâ‚‚} (âŸ¦sucâŸ§ xáµ£)))

âŸ¦âŠ†-â†‘1-injâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ (Î±áµ£ âŸ¦â†‘1âŸ§) âŸ¦âŠ†âŸ§ (Î²áµ£ âŸ¦â†‘1âŸ§) âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£) âŠ†-â†‘1-inj âŠ†-â†‘1-inj
âŸ¦âŠ†-â†‘1-injâŸ§ _ _ Î±â†‘âŠ†Î²â†‘áµ£ = mkâŸ¦âŠ†âŸ§ (Î» {xâ‚} {xâ‚‚} xáµ£ â†’ âŸ¦â„•âŸ§-cong (Î» x â†’ x âˆ¸ 1) (unâŸ¦âŠ†âŸ§ Î±â†‘âŠ†Î²â†‘áµ£ {sucá´ºâ†‘ xâ‚} {sucá´ºâ†‘ xâ‚‚} (âŸ¦sucâŸ§ xáµ£)))

âŸ¦âŠ†-unctx-+1â†‘1âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦âŠ†âŸ§ (Î²áµ£ âŸ¦â†‘1âŸ§) âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£) âŠ†-unctx-+1â†‘1 âŠ†-unctx-+1â†‘1
âŸ¦âŠ†-unctx-+1â†‘1âŸ§ _ _ Î±+âŠ†Î²â†‘áµ£ = mkâŸ¦âŠ†âŸ§ (Î» {xâ‚} {xâ‚‚} xáµ£ â†’ âŸ¦â„•âŸ§-cong (Î» x â†’ x âˆ¸ 1) (unâŸ¦âŠ†âŸ§ Î±+âŠ†Î²â†‘áµ£ {sucá´º xâ‚} {sucá´º xâ‚‚} (âŸ¦sucâŸ§ xáµ£)))

âŸ¦Î±âŠ†Ã¸â†’Î±+1âŠ†Ã¸âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ âŸ¦Ã¸âŸ§ âŸ¦â†’âŸ§ Î±áµ£ âŸ¦+1âŸ§ âŸ¦âŠ†âŸ§ âŸ¦Ã¸âŸ§) Î±âŠ†Ã¸â†’Î±+1âŠ†Ã¸ Î±âŠ†Ã¸â†’Î±+1âŠ†Ã¸
âŸ¦Î±âŠ†Ã¸â†’Î±+1âŠ†Ã¸âŸ§ _ {Î±âŠ†Ã¸} _ = mkâŸ¦âŠ†âŸ§ (Î» {x} _ â†’ Name-elim Î±âŠ†Ã¸ (predá´º x))

âŸ¦Î±+1âŠ†Ã¸â†’Î±âŠ†Ã¸âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦+1âŸ§ âŸ¦âŠ†âŸ§ âŸ¦Ã¸âŸ§ âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ âŸ¦Ã¸âŸ§) Î±+1âŠ†Ã¸â†’Î±âŠ†Ã¸ Î±+1âŠ†Ã¸â†’Î±âŠ†Ã¸
âŸ¦Î±+1âŠ†Ã¸â†’Î±âŠ†Ã¸âŸ§ _ {Î±+1âŠ†Ã¸} _ = mkâŸ¦âŠ†âŸ§ (Î» {x} _ â†’ Name-elim Î±+1âŠ†Ã¸ (sucá´º x))

-- not primitive

âŸ¦predá´º?âŸ§-core : âˆ€ {Î±â‚ Î±â‚‚} (Î±áµ£ : âŸ¦WorldâŸ§ Î±â‚ Î±â‚‚) x
                    â†’ âŸ¦MaybeâŸ§ (âŸ¦NameâŸ§ Î±áµ£) (predá´º? x) (predá´º? (protectâ†‘1 (_âŸ¨$âŸ©áµ¢_ Î±áµ£) x))
âŸ¦predá´º?âŸ§-core _  (zero  , _) = âŸ¦nothingâŸ§
âŸ¦predá´º?âŸ§-core Î±áµ£ (suc _ , _) = âŸ¦justâŸ§ (âŸ¶â‰¡.cong (Inj.to Î±áµ£) â„•e.refl)

âŸ¦predá´º?âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î±áµ£ âŸ¦â†‘1âŸ§) âŸ¦â†’âŸ§ âŸ¦MaybeâŸ§ (âŸ¦NameâŸ§ Î±áµ£)) predá´º? predá´º?
âŸ¦predá´º?âŸ§ {_} {Î±â‚‚} Î±áµ£ {xâ‚} {xâ‚‚} xáµ£ = helper {xâ‚‚} (â‰¡á´ºâ‡’â‰¡ xáµ£)
    -- BUG: the 'with' notation failed here
  where helper : âˆ€ {xâ‚‚} (eq : protectâ†‘1 (_âŸ¨$âŸ©áµ¢_ Î±áµ£) xâ‚ â‰¡ xâ‚‚) â†’ âŸ¦MaybeâŸ§ (âŸ¦NameâŸ§ Î±áµ£) (predá´º? xâ‚) (predá´º? xâ‚‚)
        helper â‰¡.refl = âŸ¦predá´º?âŸ§-core Î±áµ£ xâ‚

âŸ¦âŠ†-ctx-+1â†‘1âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£ âŸ¦â†’âŸ§ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦âŠ†âŸ§ (Î²áµ£ âŸ¦â†‘1âŸ§)) âŠ†-ctx-+1â†‘1 âŠ†-ctx-+1â†‘1
âŸ¦âŠ†-ctx-+1â†‘1âŸ§ Î±áµ£ Î²áµ£ {Î±âŠ†Î²â‚} {Î±âŠ†Î²â‚‚} Î±âŠ†Î²áµ£ = mkâŸ¦âŠ†âŸ§ (Î» {xâ‚} {xâ‚‚} xáµ£ â†’ helper {xâ‚} {xâ‚‚} (â‰¡á´ºâ‡’â‰¡ xáµ£)) where
  helper : (âŸ¦NameâŸ§â‰¡ (Î±áµ£ âŸ¦+1âŸ§) âŸ¦â†’âŸ§ âŸ¦NameâŸ§ (Î²áµ£ âŸ¦â†‘1âŸ§)) (coerceá´º (âŠ†-ctx-+1â†‘1 Î±âŠ†Î²â‚)) (coerceá´º (âŠ†-ctx-+1â†‘1 Î±âŠ†Î²â‚‚))
  helper {zero  , ()} _
  helper {suc x , p} â‰¡.refl = âŸ¦sucâŸ§ (unâŸ¦âŠ†âŸ§ Î±âŠ†Î²áµ£ {x , p} {Î±áµ£ âŸ¨$âŸ©áµ¢ (x , p)} â„•e.refl)

âŸ¦Â¬NameâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ âŸ¦Ã¸âŸ§ âŸ¦â†’âŸ§ (âŸ¦Â¬âŸ§(âŸ¦NameâŸ§ Î±áµ£))) Â¬Name Â¬Name
âŸ¦Â¬NameâŸ§ _ {Î±âŠ†Ã¸â‚} _ {xâ‚} _ = Name-elim Î±âŠ†Ã¸â‚ xâ‚

âŸ¦âŠ†-cong-+âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£ âŸ¦â†’âŸ§ (âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§ ((Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£) âŸ¦âŠ†âŸ§ (Î²áµ£ âŸ¦+áµ‚âŸ§ káµ£)))) âŠ†-cong-+ âŠ†-cong-+
âŸ¦âŠ†-cong-+âŸ§ _ _ Î±âŠ†Î²áµ£ âŸ¦zeroâŸ§    = Î±âŠ†Î²áµ£
âŸ¦âŠ†-cong-+âŸ§ _ _ Î±âŠ†Î²áµ£ (âŸ¦sucâŸ§ káµ£) = âŸ¦âŠ†-cong-+1âŸ§ _ _ (âŸ¦âŠ†-cong-+âŸ§ _ _ Î±âŠ†Î²áµ£ káµ£)

âŸ¦âŠ†-+-injâŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âŸ¨ káµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§ ((Î±áµ£ âŸ¦+áµ‚âŸ§ káµ£) âŸ¦âŠ†âŸ§ (Î²áµ£ âŸ¦+áµ‚âŸ§ káµ£)) âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£) âŠ†-+-inj âŠ†-+-inj
âŸ¦âŠ†-+-injâŸ§ _ _ âŸ¦zeroâŸ§    Î±âŠ†Î²áµ£ = Î±âŠ†Î²áµ£
âŸ¦âŠ†-+-injâŸ§ _ _ (âŸ¦sucâŸ§ káµ£) Î±âŠ†Î²áµ£ = âŸ¦âŠ†-+-injâŸ§ _ _ káµ£ (âŸ¦âŠ†-+1-injâŸ§ _ _ Î±âŠ†Î²áµ£)

âŸ¦âŠ†-assoc-+â€²âŸ§ : (âˆ€âŸ¨ Î±áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ âˆ€âŸ¨ Î²áµ£ âˆ¶ âŸ¦WorldâŸ§ âŸ©âŸ¦â†’âŸ§ Î±áµ£ âŸ¦âŠ†âŸ§ Î²áµ£ âŸ¦â†’âŸ§ (âŸ¨ kâ‚áµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§ (âŸ¨ kâ‚‚áµ£ âˆ¶ âŸ¦â„•âŸ§ âŸ©âŸ¦â†’âŸ§
                 (Î±áµ£ âŸ¦+áµ‚âŸ§ (kâ‚‚áµ£ âŸ¦+â„•âŸ§ kâ‚áµ£)) âŸ¦âŠ†âŸ§ ((Î²áµ£ âŸ¦+áµ‚âŸ§ kâ‚áµ£) âŸ¦+áµ‚âŸ§ kâ‚‚áµ£)))) âŠ†-assoc-+â€² âŠ†-assoc-+â€²
âŸ¦âŠ†-assoc-+â€²âŸ§ _ _ base kâ‚ âŸ¦zeroâŸ§      = âŸ¦âŠ†-cong-+âŸ§ _ _ base kâ‚
âŸ¦âŠ†-assoc-+â€²âŸ§ _ _ base kâ‚ (âŸ¦sucâŸ§ kâ‚‚)  = âŸ¦âŠ†-cong-+1âŸ§ _ _ (âŸ¦âŠ†-assoc-+â€²âŸ§ _ _ base kâ‚ kâ‚‚)
